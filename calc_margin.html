<!doctype html>
<html lang="ru" data-ym-id="105600432">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Калькулятор маржи — Kommdir Systems</title>
  <meta name="description" content="Калькулятор маржи WB/Ozon: прибыль на единицу, маржа %, порог DRR и сценарии."/>
  <link rel="icon" href="assets/favicon.png"/>
  <link rel="stylesheet" href="assets/styles.css?v=6"/>

  <!-- Yandex.Metrika counter -->
  <script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)}
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; } }
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105600432', 'ym');

    ym(105600432, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", referrer: document.referrer, url: location.href, accurateTrackBounce:true, trackLinks:true});
  </script>
  <noscript><div><img src="https://mc.yandex.ru/watch/105600432" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
  <!-- /Yandex.Metrika counter -->

  <style>
    .calc-grid{display:grid; gap:14px; grid-template-columns:1.05fr .95fr; align-items:start}
    @media(max-width:960px){.calc-grid{grid-template-columns:1fr}}
    .field{display:flex; flex-direction:column; gap:6px}
    .field label{color: var(--muted); font-weight:800; font-size:13px}
    .field small{color: var(--muted); font-size:12px; line-height:1.35}
    input, select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: var(--text);
      font-weight:800;
      outline:none;
    }
    input::placeholder{color: rgba(169,181,212,.65); font-weight:700}
    input:focus, select:focus{
      border-color: rgba(110,231,255,.45);
      background: rgba(255,255,255,.06);
    }
    .seg{display:flex; gap:10px; flex-wrap:wrap}
    .seg button{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      border-radius:999px;
      padding:9px 12px;
      font-weight:900;
      cursor:pointer;
    }
    .seg button.active{color: var(--text); border-color: rgba(110,231,255,.40); background: rgba(110,231,255,.10)}
    .row{display:flex; justify-content:space-between; gap:10px; padding:10px 0; border-top:1px solid rgba(255,255,255,.10)}
    .row:first-child{border-top:none}
    .val{font-weight:900}
    .ok{color: rgba(52,211,153,.95)}
    .bad{color: rgba(255,107,107,.95)}
    .warn{color: rgba(245,198,106,.95)}
    .mono{font-variant-numeric: tabular-nums}
  </style>
</head>
<body id="top">

  <!-- Icon sprite -->
  <svg xmlns="http://www.w3.org/2000/svg" style="position:absolute;width:0;height:0;overflow:hidden">
    <symbol id="ico-check" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M20 6L9 17l-5-5"/>
    </symbol>
    <symbol id="ico-x" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M18 6L6 18M6 6l12 12"/>
    </symbol>
    <symbol id="ico-shield" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 3l8 4v6c0 5-3.5 9-8 10-4.5-1-8-5-8-10V7l8-4z"/>
      <path d="M9 12l2 2 4-5"/>
    </symbol>
    <symbol id="ico-chart" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round">
      <path d="M4 19V5"/>
      <path d="M4 19h16"/>
      <path d="M8 15v-4"/>
      <path d="M12 15V7"/>
      <path d="M16 15v-2"/>
    </symbol>
    <symbol id="ico-grid" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round">
      <path d="M4 4h7v7H4z"/>
      <path d="M13 4h7v7h-7z"/>
      <path d="M4 13h7v7H4z"/>
      <path d="M13 13h7v7h-7z"/>
    </symbol>
    <symbol id="ico-clock" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round">
      <path d="M12 22a10 10 0 1 0-10-10 10 10 0 0 0 10 10z"/>
      <path d="M12 6v6l4 2"/>
    </symbol>
    <symbol id="ico-bolt" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round">
      <path d="M13 2L3 14h7l-1 8 10-12h-7l1-8z"/>
    </symbol>
    <symbol id="ico-db" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round">
      <ellipse cx="12" cy="5" rx="8" ry="3"/>
      <path d="M4 5v6c0 1.7 3.6 3 8 3s8-1.3 8-3V5"/>
      <path d="M4 11v6c0 1.7 3.6 3 8 3s8-1.3 8-3v-6"/>
    </symbol>
    <symbol id="ico-arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.1" stroke-linecap="round" stroke-linejoin="round">
      <path d="M5 12h12"/>
      <path d="M13 6l6 6-6 6"/>
    </symbol>
  </svg>


  <div class="floating">
    <a class="btn primary" href="tg.html?g=tg_float" data-track="tg">Написать в Telegram</a>
  </div>

  <header class="site-header">
    <div class="container header-row">
      <a class="brand" href="index.html" aria-label="Kommdir Systems">
        <img src="assets/fox.png" alt="Fox logo">
        <span class="brand-name">Kommdir Systems</span>
        <span class="badge" data-i18n="brand_badge">WB • Ozon • BI • Автоматизация</span>
      </a>

      <div class="nav" data-nav>
        <button class="burger btn small" type="button" aria-label="Открыть меню" aria-expanded="false" data-nav-toggle>☰</button>
        <nav class="nav-links" aria-label="Навигация">
          <a href="index.html" data-i18n="nav_home">Главная</a>
          <a href="services.html" data-i18n="nav_services">Услуги</a>
          <a href="cases.html" data-i18n="nav_cases">Кейсы</a>
          <a href="demos.html" data-i18n="nav_demo">Демо</a>
          <a href="index.html#contact" data-i18n="nav_contacts">Контакты</a>
          <a class="btn small primary" href="tg.html?g=header" data-i18n="nav_write">Написать</a>
        </nav>
      </div>

      <div class="lang" aria-label="Language">
        <button type="button" data-lang-btn="ru" class="active">RU</button>
        <button type="button" data-lang-btn="en">EN</button>
      </div>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="container">
        <div class="hero-frame">
          <div class="hero-inner">
            <div>
              <div class="kicker">Unit economics</div>
              <h1>Калькулятор маржи WB / Ozon</h1>
              <p class="lead">Быстро оценить прибыль на единицу, маржу %, порог DRR и прибыль в месяц по плану. Для точности берите “цену к начислению” из фин. отчёта кабинета.</p>
              <div class="btn-row" style="margin-top:14px">
                <a class="btn" href="xgrow_planner_calc.html" target="_blank" rel="noopener">Открыть планер SKU</a>
                <a class="btn ghost" href="demos.html">Назад в демо</a>
              </div>
            </div>
            <div class="hero-visual" aria-hidden="true"><img src="assets/hero_demo.svg" alt=""></div>
          </div>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="container">
        <div class="calc-grid">
          <div class="card pad">
            <h2 style="margin-bottom:10px">Ввод</h2>

            <div class="callout" style="margin-bottom:14px">
              Совет: если вы не уверены в скидках/СПП — вводите <b>цену к начислению</b> (она решает 80% ошибок).
            </div>

            <div class="seg" style="margin-bottom:12px">
              <button type="button" class="active" id="modeNetBtn">Цена к начислению</button>
              <button type="button" id="modeCardBtn">Цена на карточке</button>
            </div>

            <div class="grid" style="grid-template-columns:repeat(2,minmax(0,1fr)); gap:12px">
              <div class="field" id="netPriceWrap">
                <label for="netPrice">Цена к начислению, ₽</label>
                <input class="mono" id="netPrice" inputmode="decimal" placeholder="например 2 990"/>
                <small>Если есть отчёт “финансы” — берите оттуда.</small>
              </div>

              <div class="field" id="cardPriceWrap" style="display:none">
                <label for="cardPrice">Цена на карточке, ₽</label>
                <input class="mono" id="cardPrice" inputmode="decimal" placeholder="например 3 490"/>
                <small>Используйте, если нет цены к начислению.</small>
              </div>

              <div class="field" id="discountWrap" style="display:none">
                <label for="discount">Скидка/СПП, %</label>
                <input class="mono" id="discount" inputmode="decimal" placeholder="например 10"/>
                <small>Просто для приближённого расчёта.</small>
              </div>

              <div class="field">
                <label for="units">План продаж, шт/мес</label>
                <input class="mono" id="units" inputmode="decimal" placeholder="например 250"/>
                <small>Нужно для расчёта прибыли в месяц.</small>
              </div>

              <div class="field">
                <label for="commission">Комиссия МП, %</label>
                <input class="mono" id="commission" inputmode="decimal" placeholder="например 15"/>
                <small>Если не знаете — поставьте среднее по категории.</small>
              </div>

              <div class="field">
                <label for="tax">Налог, %</label>
                <input class="mono" id="tax" inputmode="decimal" placeholder="например 6"/>
                <small>УСН 6% / другое. Если не учитываете — 0.</small>
              </div>

              <div class="field">
                <label for="cogs">Себестоимость, ₽/ед</label>
                <input class="mono" id="cogs" inputmode="decimal" placeholder="например 1 450"/>
              </div>

              <div class="field">
                <label for="packaging">Упаковка/прочее, ₽/ед</label>
                <input class="mono" id="packaging" inputmode="decimal" placeholder="например 35"/>
              </div>

              <div class="field">
                <label for="mpLogistics">Логистика МП, ₽/ед</label>
                <input class="mono" id="mpLogistics" inputmode="decimal" placeholder="например 140"/>
              </div>

              <div class="field">
                <label for="fulfillment">Склад/фулфилмент, ₽/ед</label>
                <input class="mono" id="fulfillment" inputmode="decimal" placeholder="например 25"/>
              </div>

              <div class="field">
                <label for="lastMile">Последняя миля, ₽/ед</label>
                <input class="mono" id="lastMile" inputmode="decimal" placeholder="например 0"/>
              </div>

              <div class="field">
                <label for="otherCost">Прочие расходы, ₽/ед</label>
                <input class="mono" id="otherCost" inputmode="decimal" placeholder="например 0"/>
              </div>
            </div>

            <hr class="sep"/>

            <h3>Реклама</h3>
            <div class="seg" style="margin:10px 0 12px">
              <button type="button" class="active" id="adsDrrBtn">DRR, %</button>
              <button type="button" id="adsRubBtn">₽/ед</button>
            </div>

            <div class="grid" style="grid-template-columns:repeat(2,minmax(0,1fr)); gap:12px">
              <div class="field" id="adsDrrWrap">
                <label for="adsDRR">DRR, %</label>
                <input class="mono" id="adsDRR" inputmode="decimal" placeholder="например 8"/>
                <small>Реклама как % от выручки.</small>
              </div>
              <div class="field" id="adsRubWrap" style="display:none">
                <label for="adsRub">Реклама, ₽/ед</label>
                <input class="mono" id="adsRub" inputmode="decimal" placeholder="например 120"/>
                <small>Если считаете в рублях на единицу.</small>
              </div>

              <div class="field">
                <label for="returnsRate">Возвраты, %</label>
                <input class="mono" id="returnsRate" inputmode="decimal" placeholder="например 6"/>
              </div>
              <div class="field">
                <label for="returnCost">Стоимость возврата, ₽</label>
                <input class="mono" id="returnCost" inputmode="decimal" placeholder="например 80"/>
                <small>Если не учитываете — 0.</small>
              </div>
            </div>

            <div class="btn-row" style="margin-top:14px">
              <button class="btn primary" type="button" id="copyBtn">Скопировать итог</button>
              <button class="btn" type="button" id="csvBtn">Скачать CSV</button>
              <a class="btn ghost" href="tg.html?g=calc_margin">Написать и разобрать</a>
            </div>
          </div>

          <div class="card pad">
            <h2 style="margin-bottom:10px">Результат</h2>

            <div class="row">
              <div class="muted">Цена к начислению</div>
              <div class="val mono" id="outNet">0 ₽</div>
            </div>

            <div class="row">
              <div class="muted">Комиссия МП</div>
              <div class="val mono" id="outCommission">0 ₽</div>
            </div>

            <div class="row">
              <div class="muted">Налог</div>
              <div class="val mono" id="outTax">0 ₽</div>
            </div>

            <div class="row">
              <div class="muted">Логистика + склад</div>
              <div class="val mono" id="outLog">0 ₽</div>
            </div>

            <div class="row">
              <div class="muted">Себестоимость + упаковка</div>
              <div class="val mono" id="outCogs">0 ₽</div>
            </div>

            <div class="row">
              <div class="muted">Возвраты (в среднем)</div>
              <div class="val mono" id="outReturns">0 ₽</div>
            </div>

            <div class="row">
              <div class="muted">Реклама</div>
              <div class="val mono" id="outAds">0 ₽</div>
            </div>

            <hr class="sep"/>

            <div class="row">
              <div class="muted"><b>Прибыль/ед</b></div>
              <div class="val mono" id="outProfitUnit">0 ₽</div>
            </div>

            <div class="row">
              <div class="muted"><b>Маржа</b></div>
              <div class="val mono" id="outMargin">0%</div>
            </div>

            <div class="row">
              <div class="muted"><b>Порог DRR</b></div>
              <div class="val mono" id="outBreakeven">0%</div>
            </div>

            <hr class="sep"/>

            <div class="row">
              <div class="muted"><b>Прибыль в месяц</b></div>
              <div class="val mono" id="outProfitMonth">0 ₽</div>
            </div>

            <div class="callout" style="margin-top:14px" id="healthNote">
              Заполните поля — покажу маржу и порог DRR.
            </div>

            <div class="micro" style="margin-top:10px">
              Это модель. На реальных кабинетах есть нюансы: компенсации, платные услуги, штрафы, разница “к начислению” и “к выплате”.
              Для точности — сверяемся с вашим финансовым отчётом.
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container">
      <div class="footer-row">
        <div>
          <div class="brand" style="gap:10px">
            <img src="assets/fox.png" alt="Fox logo">
            <strong>Kommdir Systems</strong>
          </div>
          <div class="micro">© <span id="y"></span> · Marketplace CCO · BI/Automation</div>
        </div>
        <div class="footer-links">
          <a href="index.html" data-i18n="nav_home">Главная</a>
          <a href="services.html" data-i18n="nav_services">Услуги</a>
          <a href="cases.html" data-i18n="nav_cases">Кейсы</a>
          <a href="demos.html" data-i18n="nav_demo">Демо</a>
          <a href="#top">↑</a>
        </div>
      </div>
    </div>
  </footer>

  <script src="assets/site.js?v=6"></script>
  <script src="assets/i18n.js?v=6"></script>
  <script>
    document.getElementById('y').textContent = new Date().getFullYear();

    function n(v){
      if(v===null || v===undefined) return 0;
      var s = String(v).replace(/\s+/g,'').replace(',', '.');
      var x = parseFloat(s);
      return isNaN(x) ? 0 : x;
    }
    function money(x){
      try{
        return new Intl.NumberFormat('ru-RU',{maximumFractionDigits:0}).format(Math.round(x)) + ' ₽';
      }catch(e){
        return Math.round(x) + ' ₽';
      }
    }
    function pct(x){
      return (isFinite(x)? x : 0).toFixed(1) + '%';
    }

    var mode = 'net'; // net|card
    var adsMode = 'drr'; // drr|rub

    function setMode(m){
      mode = m;
      document.getElementById('modeNetBtn').classList.toggle('active', m==='net');
      document.getElementById('modeCardBtn').classList.toggle('active', m==='card');
      document.getElementById('netPriceWrap').style.display = (m==='net') ? '' : 'none';
      document.getElementById('cardPriceWrap').style.display = (m==='card') ? '' : 'none';
      document.getElementById('discountWrap').style.display = (m==='card') ? '' : 'none';
      calc();
    }

    function setAdsMode(m){
      adsMode = m;
      document.getElementById('adsDrrBtn').classList.toggle('active', m==='drr');
      document.getElementById('adsRubBtn').classList.toggle('active', m==='rub');
      document.getElementById('adsDrrWrap').style.display = (m==='drr') ? '' : 'none';
      document.getElementById('adsRubWrap').style.display = (m==='rub') ? '' : 'none';
      calc();
    }

    function calc(){
      var netPrice = 0;
      if(mode==='net'){
        netPrice = n(document.getElementById('netPrice').value);
      }else{
        var cardPrice = n(document.getElementById('cardPrice').value);
        var disc = n(document.getElementById('discount').value);
        netPrice = cardPrice * (1 - disc/100);
      }
      var units = Math.max(0, Math.round(n(document.getElementById('units').value)));

      var commissionPct = Math.max(0, n(document.getElementById('commission').value));
      var taxPct = Math.max(0, n(document.getElementById('tax').value));

      var cogs = Math.max(0, n(document.getElementById('cogs').value));
      var packaging = Math.max(0, n(document.getElementById('packaging').value));
      var mpLog = Math.max(0, n(document.getElementById('mpLogistics').value));
      var fulfillment = Math.max(0, n(document.getElementById('fulfillment').value));
      var lastMile = Math.max(0, n(document.getElementById('lastMile').value));
      var otherCost = Math.max(0, n(document.getElementById('otherCost').value));

      var returnsRate = Math.max(0, n(document.getElementById('returnsRate').value));
      var returnCost = Math.max(0, n(document.getElementById('returnCost').value));
      var returnsPerUnit = (returnsRate/100) * returnCost;

      var commissionRub = netPrice * commissionPct/100;
      var taxRub = netPrice * taxPct/100;
      var logRub = mpLog + fulfillment + lastMile;
      var cogsRub = cogs + packaging;
      var fixedCostsExAds = commissionRub + taxRub + logRub + cogsRub + returnsPerUnit + otherCost;

      var adsRub = 0;
      if(adsMode==='drr'){
        var drr = Math.max(0, n(document.getElementById('adsDRR').value));
        adsRub = netPrice * drr/100;
      }else{
        adsRub = Math.max(0, n(document.getElementById('adsRub').value));
      }

      var totalCosts = fixedCostsExAds + adsRub;
      var profitUnit = netPrice - totalCosts;
      var marginPct = (netPrice>0) ? (profitUnit/netPrice*100) : 0;

      // Break-even DRR % (если реклама в %)
      var breakevenDrrPct = 0;
      if(netPrice>0){
        breakevenDrrPct = Math.max(0, (netPrice - fixedCostsExAds)/netPrice*100);
      }

      var profitMonth = profitUnit * units;

      document.getElementById('outNet').textContent = money(netPrice);
      document.getElementById('outCommission').textContent = money(commissionRub);
      document.getElementById('outTax').textContent = money(taxRub);
      document.getElementById('outLog').textContent = money(logRub);
      document.getElementById('outCogs').textContent = money(cogsRub);
      document.getElementById('outReturns').textContent = money(returnsPerUnit);
      document.getElementById('outAds').textContent = money(adsRub);
      document.getElementById('outProfitUnit').textContent = money(profitUnit);
      document.getElementById('outMargin').textContent = pct(marginPct);
      document.getElementById('outBreakeven').textContent = pct(breakevenDrrPct);
      document.getElementById('outProfitMonth').textContent = money(profitMonth);

      var note = document.getElementById('healthNote');
      var cls = 'warn';
      var msg = 'Заполните поля — покажу маржу и порог DRR.';
      if(netPrice>0){
        if(marginPct >= 20){ cls='ok'; msg='Маржа выглядит здоровой. Теперь проверяем стабильность и масштабирование.'; }
        else if(marginPct >= 10){ cls='warn'; msg='Маржа тонкая. Важно держать DRR и контролировать остатки/скидки.'; }
        else if(marginPct >= 0){ cls='bad'; msg='Маржа на грани. Любой рост DRR или логистики утащит прибыль в ноль.'; }
        else { cls='bad'; msg='Отрицательная маржа. Нужно менять цену/рекламу/себестоимость или стратегию SKU.'; }
      }
      note.classList.remove('ok','warn','bad');
      note.classList.add(cls);
      note.textContent = msg;
    }

    function copySummary(){
      var net = document.getElementById('outNet').textContent;
      var profitU = document.getElementById('outProfitUnit').textContent;
      var margin = document.getElementById('outMargin').textContent;
      var be = document.getElementById('outBreakeven').textContent;
      var pm = document.getElementById('outProfitMonth').textContent;

      var txt = [
        'Kommdir Systems — маржа (WB/Ozon)',
        'Цена к начислению: ' + net,
        'Прибыль/ед: ' + profitU,
        'Маржа: ' + margin,
        'Порог DRR: ' + be,
        'Прибыль/мес: ' + pm
      ].join('\n');

      navigator.clipboard.writeText(txt).then(function(){
        try{ if(typeof ym==='function'){ ym(105600432,'reachGoal','calc_margin_copy'); } }catch(e){}
      });
    }

    function downloadCSV(){
      var rows = [];
      rows.push(['net_price','profit_unit','margin_pct','breakeven_drr_pct','profit_month'].join(','));
      rows.push([
        document.getElementById('outNet').textContent.replace(/[^0-9]/g,''),
        document.getElementById('outProfitUnit').textContent.replace(/[^0-9-]/g,''),
        document.getElementById('outMargin').textContent.replace('%','').trim(),
        document.getElementById('outBreakeven').textContent.replace('%','').trim(),
        document.getElementById('outProfitMonth').textContent.replace(/[^0-9-]/g,'')
      ].join(','));

      var blob = new Blob([rows.join('\n')], {type:'text/csv;charset=utf-8;'});
      var url = URL.createObjectURL(blob);
      var a = document.createElement('a');
      a.href = url;
      a.download = 'margin_calc.csv';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      try{ if(typeof ym==='function'){ ym(105600432,'reachGoal','calc_margin_csv'); } }catch(e){}
    }

    // listeners
    ['netPrice','cardPrice','discount','units','commission','tax','cogs','packaging','mpLogistics','fulfillment','lastMile','otherCost','adsDRR','adsRub','returnsRate','returnCost']
      .forEach(function(id){
        var el = document.getElementById(id);
        if(el) el.addEventListener('input', calc);
      });

    document.getElementById('modeNetBtn').addEventListener('click', function(){ setMode('net'); });
    document.getElementById('modeCardBtn').addEventListener('click', function(){ setMode('card'); });

    document.getElementById('adsDrrBtn').addEventListener('click', function(){ setAdsMode('drr'); });
    document.getElementById('adsRubBtn').addEventListener('click', function(){ setAdsMode('rub'); });

    document.getElementById('copyBtn').addEventListener('click', copySummary);
    document.getElementById('csvBtn').addEventListener('click', downloadCSV);

    // init
    calc();
  </script>
</body>
</html>
